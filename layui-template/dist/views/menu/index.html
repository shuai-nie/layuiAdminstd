<title>用户组</title>

<div class="layui-card layadmin-header">
    <div class="layui-breadcrumb" lay-filter="breadcrumb">
        <a lay-href="">主页</a>
        <a><cite>用户组</cite></a>
    </div>
</div>

<div class="layui-fluid" id="LAY-app-message">
    <div class="layui-card">
        <div class="layui-tab layui-tab-brief">
            <ul class="layui-tab-title">
                <li class="layui-this">全部消息</li>
            </ul>

            <div class="layui-tab-content">

                <div class="layui-tab-item layui-show">

                    <table class="layui-hide" id="tableId" lay-filter="tableEvent"></table>

                </div>

            </div>

            <script type="text/html" id="barDemo">
                <a class="layui-btn layui-btn-warm layui-btn-xs" lay-event="edit">编辑</a>
                <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delete">删除</a>
            </script>

        </div>
    </div>
</div>

<script>
layui.config({
    base: 'dist/'
}).extend({
    tableEdit: 'lib/extend/tableEdit'
    , tableTree: 'lib/extend/tableTree'
}).use(['admin', 'table', 'util', 'tableTree', 'tableEdit'], function() {
    var $ = layui.$
        , tableEdit = layui.tableEdit
        , tableTree = layui.tableTree
        , admin = layui.admin
        , table = layui.table
        , element = layui.element;

    tableTree.render({
        elem: '#tableId'
        ,id:'tableTree'
        ,url:'json/tableTree.json'
        ,height: 'full-90'
        ,size:'sm'
        ,toolbar: '#toolbarDemo' //开启头部工具栏，并为其绑定左侧模板
        ,defaultToolbar: ['filter', 'exports', 'print', { //自定义头部工具栏右侧图标。如无需自定义，去除该参数即可
            title: '提示'
            ,layEvent: 'LAYTABLE_TIPS'
            ,icon: 'layui-icon-tips'
        }]
        ,page: true
        ,treeConfig:{ //表格树所需配置
            showField:'treeName' //表格树显示的字段
            ,treeid:'id' //treeid所对应字段的值在表格数据中必须是唯一的，且不能为空。
            ,treepid:'pid'//父级id字段名称
            ,iconClass:'layui-icon-right' //小图标class样式 窗口图标 layui-icon-layer
            ,showToolbar: true //展示工具栏 false不展示 true展示
        }
        ,cols: [[
            {type:'checkbox'}
            ,{field:'treeName',title: '名称',width:300}
            ,{field:'id',title:'id',sort:true,event:'id',config:{type:'input'},width:120}
            ,{field:'sort', title: '排序',event:'sort',width:70,config:{type:'input'}}
            ,{field:'url',title:'路径',event:'url',config:{type:'input'},width:150}
            ,{field:'permissionId ',width:150, title: '权限标识',event:'permissionId',config:{type:'input'}}
            ,{field:'createDate', title: '创建时间',event:'date',width:120,config:{type:'date',dateType:'date'}}
            ,{field:'type',title:'类型',event:'type',config:{type:'select',data:[{name:1,value:'菜单'},{name:2,value:'按钮'}]},width:150}
        ]],done:function () {
            treeTable.closeAllTreeNodes();
            treeTable.openTreeNode(1)
        }
    });

    // 监听表格树event tool事件
    tableTree.on('tool(tableEvent)',function (obj) {
        var field = obj.field; //单元格字段
        var value = obj.value; //修改后的值
        var data = obj.data; //当前行数据
        var event = obj.event; //当前单元格事件
        if(event === 'update'){
            obj.update(value); //数据更新
        }

        //event为del为删除 add则新增 async则异步请求数据
        if(event === 'del'){
            obj.del(); //删除节点及其子节点
        }
        if(event === 'add'){ //点击操作栏加号图标时触发
            //异步、同步都可以使用
            //obj.add(arr)生成表格树,arr参数为数组，数组中元素的treeid字段值重复则被过滤掉
            obj.add([]) //参数不传或为空数组时 => 新增空行
        }
        if(event === 'async'){ //点击方向箭头小图标时触发
            //可ajax异步请求后台数据,回调obj.async(arr)生成表格树,arr参数为数组
            //数组中元素的treeid字段值重复则被过滤掉
            obj.async([{"id":'abc',"treeName":'abc',"permissionId ":'abc',"sort":'3333',createDate:'2020-02-02',type:'1'}]);
        }
    });

    // 监听树形表格复选框
    tableTree.on('checkbox(tableEvent)', function(obj){
        console.log(obj.checked); //当前是否选中状态
        console.log(obj.data); //选中行的相关数据
        console.log(obj.type); //如果触发的是全选，则为：all，如果触发的是单选，则为：one
    });

    // 监听树形表格工具条
    table.on('toolbar(tableEvent)', function(obj){
        treeTable.addTopTreeNode();         //新增最上级节点
        treeTable.getCheckedTreeNodeData(); //获取选中行的树状数据
        treeTable.getTableTreeData();       //获取表格树所有数据
        treeTable.closeTreeNode('5');       //指定tr/节点id折叠节点
        treeTable.openTreeNode(5);          //指定tr/节点id展开相对应树节点
        treeTable.closeAllTreeNodes();      //折叠所有节点
        treeTable.openAllTreeNodes();       //展开所有节点
        treeTable.getTreeOptions();         //获取表格配置
        treeTable.reload();                 //表格树reload
        treeTable.delTreeNode('1');         //指定tr/节点id删除节点及相关叶子节点
        treeTable.clearSearch();            //重置搜索前表格树折叠状态
        treeTable.refresh(rs);              //传数据刷新、不传刷新当前表格树，但不重载。
        treeTable.sortByTreeNode(5,'sort',false);  //指定节点/节点id和字段对其叶子节点逐级排序
    });

    // 监听树形表格排序
    table.on('sort(tableEvent)', function(obj){
        treeTable.sort({field:obj.field,desc:obj.type === 'desc'}) //整个表格树节点及其叶子逐级排序
    });




        var DISABLED = 'layui-btn-disabled'
        //区分各选项卡中的表格
        ,tabs = {
            all: {
                text: '全部消息'
                ,id: 'LAY-app-message-all'
            }
            ,notice: {
                text: '通知'
                ,id: 'LAY-app-message-notice'
            }
            ,direct: {
                text: '私信'
                ,id: 'LAY-app-message-direct'
            }
        };

    //标题内容模板
    var tplTitle = function(d){
        return '<a lay-href="app/message/detail/id='+ d.id +'">'+ d.title;
    };

    //全部消息
    table.render({
        elem: '#LAY-app-message-all'
        ,url: '/api/v1/menu/index' //模拟接口
        ,page: true
        ,cols: [[
            {type: 'checkbox', fixed: 'left'}
            ,{field: 'Module', title: '模块', width: 100}
            ,{field: 'Type', title: '类型', width: 100}
            ,{field: 'Title', title: '标题内容', width: 100}
            ,{field: 'Description', title: '描述', width: 120}
            ,{fixed: 'right', title: '操作', width: 150, align:'center', toolbar: '#barDemo'}
        ]]
        // ,skin: 'line'
    });

    //通知
    table.render({
        elem: '#LAY-app-message-notice'
        ,url: './json/message/notice.js' //模拟接口
        ,page: true
        ,cols: [[
            {type: 'checkbox', fixed: 'left'}
            ,{field: 'title', title: '标题内容', minWidth: 300, templet: tplTitle}
            ,{field: 'time', title: '时间', width: 170, templet: '<div>{{ layui.util.timeAgo(d.time) }}</div>'}
        ]]
        ,skin: 'line'
    });

    //私信
    table.render({
        elem: '#LAY-app-message-direct'
        ,url: './json/message/direct.js' //模拟接口
        ,page: true
        ,cols: [[
            {type: 'checkbox', fixed: 'left'}
            ,{field: 'title', title: '标题内容', minWidth: 300, templet: tplTitle}
            ,{field: 'time', title: '时间', width: 170, templet: '<div>{{ layui.util.timeAgo(d.time) }}</div>'}
        ]]
        ,skin: 'line'
    });

    //事件处理
    var events = {
        del: function(othis, type){
            var thisTabs = tabs[type]
                ,checkStatus = table.checkStatus(thisTabs.id)
                ,data = checkStatus.data; //获得选中的数据
            if(data.length === 0) return layer.msg('未选中行');

            layer.confirm('确定删除选中的数据吗？', function(){
                /*
                admin.req('url', {}, function(){ //请求接口
                  //do somethin
                });
                */
                //此处只是演示，实际应用需把下述代码放入上述Ajax回调中
                layer.msg('删除成功', {
                    icon: 1
                });
                table.reload(thisTabs.id); //刷新表格
            });
        }
        ,ready: function(othis, type){
            var thisTabs = tabs[type]
                ,checkStatus = table.checkStatus(thisTabs.id)
                ,data = checkStatus.data; //获得选中的数据
            if(data.length === 0) return layer.msg('未选中行');

            //此处只是演示
            layer.msg('标记已读成功', {
                icon: 1
            });
            table.reload(thisTabs.id); //刷新表格
        }
        ,readyAll: function(othis, type){
            var thisTabs = tabs[type];

            //do somethin

            layer.msg(thisTabs.text + '：全部已读', {
                icon: 1
            });
        }
    };

    $('.LAY-app-message-btns .layui-btn').on('click', function(){
        var othis = $(this)
            ,thisEvent = othis.data('events')
            ,type = othis.data('type');
        events[thisEvent] && events[thisEvent].call(this, othis, type);
    });

});
</script>